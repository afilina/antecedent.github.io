<!DOCTYPE html>
<html>
<head>
    <title>Patchwork</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="style.css" type="text/css">
    <script type="text/javascript">
    
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-20483190-1']);
      _gaq.push(['_trackPageview']);
    
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>    
</head>
<body>
    <div id="main">
        <h1><a href=".">Patchwork</a><img src="bracket.png" alt="Logo"></h1>
        <h2>Redefine <em>user-defined</em> PHP functions at runtime. No extensions required.</h2>
        
        <div class="demos">
        
            <pre class="box top left">
<span class="comment"># 1. Define a function</span>

<span class="keyword">function</span> size<span class="bracket">(</span>$x<span class="bracket">)</span>
<span class="bracket">{</span>
    <span class="keyword">return</span> count<span class="bracket">(</span>$x<span class="bracket">)</span>;
<span class="bracket">}</span>

size<span class="bracket">(</span><span class="keyword">array</span><span class="bracket">(</span>1, 2<span class="bracket">)</span><span class="bracket">)</span>; <span class="comment"># =&gt; 2</span>
            </pre>
            <pre class="box top">
<span class="comment"># 2. Replace it with a new one</span>

<span class="keyword">use</span> Patchwork <span class="keyword">as</span> p;

p\replace<span class="bracket">(</span><span class="string">"size"</span>, <span class="keyword">function</span><span class="bracket">(</span>$x<span class="bracket">)</span>
<span class="bracket">{</span>
    <span class="keyword">return</span> <span class="string">"huge"</span>;
<span class="bracket">}</span><span class="bracket">)</span>;

size<span class="bracket"><span class="bracket">(</span></span><span class="keyword">array</span><span class="bracket">(</span>1, 2<span class="bracket">)</span><span class="bracket">)</span>; <span class="comment"># =&gt; "huge"</span>
            </pre>
            <pre class="box top right">
<span class="comment"># 3. Undo the replacement</span>
    
p\undoAll<span class="bracket">(</span><span class="bracket">)</span>;

size<span class="bracket">(</span><span class="keyword">array</span><span class="bracket">(</span>1, 2<span class="bracket">)</span><span class="bracket">)</span>; <span class="comment"># => 2</span>

<span class="comment"># Note that all of these steps</span>
<span class="comment"># occur at the same runtime!</span>
            </pre>
        
        </div>
        
        <div class="box top left">
            <h3>So what does Patchwork do?</h3>
            <p>It lets you replace the definition of any named <a href="http://php.net/manual/en/functions.user-defined.php">user-defined</a> function or method at runtime. This is illustrated in the above example.</p>
        </div>
        <div class="box top">
            <h3>Can't I do that by myself?</h3>
            <p>Well, no. As of version 5.3.4, PHP won't let you compile multiple definitions of the same function, nor does its standard library have any facilities for modifying named functions at runtime.</p>
        </div>
        <div class="box top right">
            <h3>Isn't that what Runkit is for?</h3>
            <p>That's true, but unlike <a href="http://php.net/manual/en/book.runkit.php">Runkit</a>, Patchwork is not a core extension. Patchwork is written in pure PHP code for the sake of maximum portability. Sadly, it's also incapable of <a href="http://php.net/manual/en/runkit.configuration.php#ini.runkit.internal-override">redefining internal functions</a> for this exact reason.</p>
        </div>
        <div class="box bottom left">
            <h3>What could that be useful for?</h3>
            <p><a href="docs/articles/untestable-code.html">Testing all kinds of untestable code</a>. Other than that, not much. Tools like this should always be your last resort.</p>
        </div>
        <div class="box bottom">
            <h3>Okay, so where do I get it?</h3>
            <p><a href="https://github.com/antecedent/patchwork/archives/master">Here</a>. And <a href="docs">here's the documentation</a>: be sure to at least skim through it before you start!</p>
        </div>
        <div class="box bottom right">
            <h3>Hey, it doesn't work!</h3>
            <p>Well, sorry about that. If the documentation is of no help about the problem, please <a href="https://github.com/antecedent/patchwork/issues">report it</a>.</p>
        </div>
    </div>
</body>
</html>
